# qy产品红单功能数据初始化脚本

## 📌 数据库信息

**数据库：** `pubdb`  
**目标产品：** `qy`  
**操作类型：** 数据初始化（从at产品复制配置到qy产品）

---

## 🎯 要做什么？

为了让qy产品的红单（推单）功能正常运行，需要初始化3个表的数据：

1. **系统参数表** - 告诉系统要处理qy产品
2. **推单价格配置表** - 设置推单的售价规则
3. **推单等级称号表** - 设置用户等级和称号规则

**简单理解：** 就是把at产品的配置复制一份给qy产品用。

---

## ⚠️ 重要提示

- ✅ **不影响现有功能**：不会影响at产品的定时任务和数据
- ✅ **可回滚**：如果出问题可以删除qy数据恢复
- ⚠️ **按顺序执行**：必须按步骤1→2→3的顺序执行
- ⚠️ **执行后验证**：每个步骤执行完都要运行验证SQL确认结果

---

## 📝 执行步骤

### 步骤1：更新系统参数（告诉系统要处理qy产品）

**数据库：** `pubdb`  
**表名：** `S_SYSTEM_PARAMETER`  
**作用：** 把产品列表从 `'at'` 改成 `'at,qy'`，让定时任务开始处理qy产品

**执行前先看看当前值：**
```sql
SELECT VALUE 
FROM pubdb.S_SYSTEM_PARAMETER
WHERE CATEGORY = 'PUSHORDER'
  AND CODE = 'PUSHORDER_PRODUCT';
-- 应该看到：VALUE = 'at'
```

**执行SQL：**
```sql
UPDATE pubdb.S_SYSTEM_PARAMETER 
SET VALUE = 'at,qy',
    UPDATE_TIME = SYSDATE
WHERE CATEGORY = 'PUSHORDER'
  AND CODE = 'PUSHORDER_PRODUCT';

COMMIT;
```

**执行后验证：**
```sql
SELECT VALUE 
FROM pubdb.S_SYSTEM_PARAMETER
WHERE CATEGORY = 'PUSHORDER'
  AND CODE = 'PUSHORDER_PRODUCT';
-- 应该看到：VALUE = 'at,qy'
```

---

### 步骤2：复制推单价格配置（从at复制到qy）

**数据库：** `pubdb`  
**表名：** `PUSH_ORDER_PARAM_CONFIG`  
**作用：** 把at产品的推单价格配置复制给qy产品

**执行前先看看at有多少条：**
```sql
SELECT COUNT(*) AS at产品配置数量
FROM pubdb.PUSH_ORDER_PARAM_CONFIG
WHERE PRODUCT = 'at';
-- 记下这个数量，后面验证用
```

**执行SQL：**
```sql
INSERT INTO pubdb.PUSH_ORDER_PARAM_CONFIG (
    ID, REAL_NAME_IS, USER_LEVEL, LEVEL_NAME, DEPOSIT, BET_AMOUNT,
    REGISTRATION_DAY, NUMBER_FANS, DAILY_PUSH_LIMIT, PUSH_ORDERS_PRICE,
    FAN_BONUS, PUSH_ORDER_BONUS, PURCHASE_BONUS, CLICK_COUNT_BONUS,
    CONSUMPTION_AMOUNT, NUMBER_BUY, FREE_TIMES, OPERATOR, PRODUCT, OPERATOR_TIME, TYPE
)
SELECT 
    SEQ_PUSH_ORDER_PARAM_CONFIG.NEXTVAL AS ID,
    REAL_NAME_IS,
    USER_LEVEL,
    LEVEL_NAME,
    DEPOSIT,
    BET_AMOUNT,
    REGISTRATION_DAY,
    NUMBER_FANS,
    DAILY_PUSH_LIMIT,
    PUSH_ORDERS_PRICE,
    FAN_BONUS,
    PUSH_ORDER_BONUS,
    PURCHASE_BONUS,
    CLICK_COUNT_BONUS,
    CONSUMPTION_AMOUNT,
    NUMBER_BUY,
    FREE_TIMES,
    'system' AS OPERATOR,
    'qy' AS PRODUCT,
    SYSDATE AS OPERATOR_TIME,
    TYPE
FROM pubdb.PUSH_ORDER_PARAM_CONFIG
WHERE PRODUCT = 'at';

COMMIT;
```

**执行后验证：**
```sql
SELECT COUNT(*) AS qy产品配置数量
FROM pubdb.PUSH_ORDER_PARAM_CONFIG
WHERE PRODUCT = 'qy';
-- 应该和at产品的数量一样
```

---

### 步骤3：复制推单等级称号配置（从at复制到qy）

**数据库：** `pubdb`  
**表名：** `PUSH_ORDER_LEVEL_TITLE_CONFIG`  
**作用：** 把at产品的等级称号配置复制给qy产品（只复制未删除的记录）

**执行前先看看at有多少条：**
```sql
SELECT COUNT(*) AS at产品配置数量
FROM pubdb.PUSH_ORDER_LEVEL_TITLE_CONFIG
WHERE PRODUCT = 'at' AND DEL = '0';
-- 记下这个数量，后面验证用
```

**执行SQL：**
```sql
INSERT INTO pubdb.PUSH_ORDER_LEVEL_TITLE_CONFIG (
    ID, NAME, NUMBER_TWEETS, NUMBER_TWEETS_FOOTBALL, NUMBER_TWEETS_BASKETBALL,
    MALL_POINTS, RED_ORDER_RATE, NUMBER_RED, NUMBER_FANS, POPULARITY_VALUE,
    TOTAL_DEPOSIT, TOTAL_BET, SORT, TYPE, PRODUCT, OPERATOR, OPERATOR_TIME, DEL
)
SELECT 
    SEQ_PUSH_ORDER_LEVEL_TITLE_CONFIG.NEXTVAL AS ID,
    NAME,
    NUMBER_TWEETS,
    NUMBER_TWEETS_FOOTBALL,
    NUMBER_TWEETS_BASKETBALL,
    MALL_POINTS,
    RED_ORDER_RATE,
    NUMBER_RED,
    NUMBER_FANS,
    POPULARITY_VALUE,
    TOTAL_DEPOSIT,
    TOTAL_BET,
    SORT,
    TYPE,
    'qy' AS PRODUCT,
    'system' AS OPERATOR,
    SYSDATE AS OPERATOR_TIME,
    '0' AS DEL
FROM pubdb.PUSH_ORDER_LEVEL_TITLE_CONFIG
WHERE PRODUCT = 'at' AND DEL = '0';

COMMIT;
```

**执行后验证：**
```sql
SELECT COUNT(*) AS qy产品配置数量
FROM pubdb.PUSH_ORDER_LEVEL_TITLE_CONFIG
WHERE PRODUCT = 'qy' AND DEL = '0';
-- 应该和at产品的数量一样
```

---

## ✅ 最终验证（所有步骤执行完后运行）

```sql
-- 1. 验证系统参数
SELECT VALUE AS 产品列表
FROM pubdb.S_SYSTEM_PARAMETER
WHERE CATEGORY = 'PUSHORDER'
  AND CODE = 'PUSHORDER_PRODUCT';
-- 预期结果：at,qy

-- 2. 验证推单价格配置
SELECT COUNT(*) AS qy价格配置数量
FROM pubdb.PUSH_ORDER_PARAM_CONFIG
WHERE PRODUCT = 'qy';
-- 预期结果：> 0

-- 3. 验证等级称号配置
SELECT COUNT(*) AS qy等级配置数量
FROM pubdb.PUSH_ORDER_LEVEL_TITLE_CONFIG
WHERE PRODUCT = 'qy' AND DEL = '0';
-- 预期结果：> 0
```

---

## 🔄 回滚方案（如果出问题需要恢复）

```sql
-- 1. 恢复系统参数
UPDATE pubdb.S_SYSTEM_PARAMETER 
SET VALUE = 'at',
    UPDATE_TIME = SYSDATE
WHERE CATEGORY = 'PUSHORDER'
  AND CODE = 'PUSHORDER_PRODUCT';

-- 2. 删除qy产品的推单价格配置
DELETE FROM pubdb.PUSH_ORDER_PARAM_CONFIG
WHERE PRODUCT = 'qy';

-- 3. 删除qy产品的等级称号配置
DELETE FROM pubdb.PUSH_ORDER_LEVEL_TITLE_CONFIG
WHERE PRODUCT = 'qy';

COMMIT;
```

---

## 📧 执行说明

- **执行时间：** 建议在业务低峰期执行
- **执行后观察：** 执行完成后，观察定时任务日志，确认qy产品开始生成推单
- **如有问题：** 请联系开发团队
