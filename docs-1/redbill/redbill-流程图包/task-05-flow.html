<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>05. çœŸå®ç©å®¶æ¨å•ä»»åŠ¡</title>
    <script src="https://cdn.jsdelivr.net/npm/mermaid/dist/mermaid.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: "Microsoft YaHei", Arial, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }
        
        .container {
            max-width: 900px;
            margin: 0 auto;
            background: white;
            border-radius: 10px;
            box-shadow: 0 10px 40px rgba(0,0,0,0.3);
            overflow: hidden;
        }
        
        .header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 30px;
            text-align: center;
        }
        
        .header h1 {
            font-size: 28px;
            margin-bottom: 10px;
        }
        
        .header .task-id {
            display: inline-block;
            background: rgba(255,255,255,0.2);
            padding: 5px 15px;
            border-radius: 20px;
            margin-right: 10px;
            font-size: 12px;
        }
        
        .header .task-time {
            display: inline-block;
            background: rgba(255,255,255,0.2);
            padding: 5px 15px;
            border-radius: 20px;
            font-size: 12px;
        }
        
        .header p {
            margin-top: 15px;
            font-size: 14px;
            opacity: 0.9;
        }
        
        .content {
            padding: 40px;
        }
        
        .mermaid {
            display: flex;
            justify-content: center;
            background: #f9f9f9;
            border-radius: 8px;
            padding: 20px;
            overflow-x: auto;
        }
        
        .legend {
            margin-top: 30px;
            padding: 20px;
            background: #f5f5f5;
            border-left: 4px solid #667eea;
            border-radius: 5px;
        }
        
        .legend h3 {
            color: #667eea;
            margin-bottom: 15px;
            font-size: 16px;
        }
        
        .legend-items {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
        }
        
        .legend-item {
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .legend-color {
            width: 20px;
            height: 20px;
            border-radius: 3px;
            flex-shrink: 0;
        }
        
        .color-green { background: #4CAF50; }
        .color-red { background: #f44336; }
        .color-blue { background: #2196F3; }
        .color-orange { background: #FF9800; }
        .color-yellow { background: #FFC107; }
        .color-purple { background: #9C27B0; }

        .mermaid { max-width: 794px; margin: 0 auto; }
        .mermaid svg { max-width: 100%; height: auto; }

        @page { size: A4 portrait; margin: 12mm; }

        @media print {
            body { background: white; padding: 0; }
            .container { max-width: 794px; border-radius: 0; box-shadow: none; }
            .content { padding: 24px; }
            .mermaid { padding: 12px; }
        }
        
        .footer {
            padding: 20px;
            text-align: center;
            border-top: 1px solid #eee;
            background: #f9f9f9;
            font-size: 12px;
            color: #666;
        }
        
        @media (max-width: 768px) {
            .header h1 {
                font-size: 20px;
            }
            
            .content {
                padding: 20px;
            }
            
            .legend-items {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>ğŸ”§ çœŸå®ç©å®¶æ¨å•ä»»åŠ¡</h1>
            <div>
                <span class="task-id">ä»»åŠ¡ 05</span>
                <span class="task-time">â° 20:00:00</span>
            </div>
            <p>åŸºäºçœŸå®ç©å®¶å†å²æ³¨å•æ•°æ®ç”Ÿæˆæ¨å•ï¼ˆåŠAIæ¨¡å¼ï¼‰</p>
        </div>
        
        <div class="content">
            <div class="mermaid">
graph TD
    START([å®šæ—¶ä»»åŠ¡è§¦å‘<br/>20:00:00]) --> LOG1["ğŸ“ è®°å½•æ—¥å¿—<br/>AIçœŸå®æ¨å• å®šæ—¶ä»»åŠ¡ã€å¯åŠ¨ã€‘"]
    
    LOG1 --> GET_PRODUCTS["ğŸ” è·å–ç³»ç»Ÿå‚æ•°<br/>PUSHORDER_PRODUCT<br/>è·å–æ¨å•äº§å“åˆ—è¡¨"]
    
    GET_PRODUCTS --> CHECK_PRODUCTS{äº§å“åˆ—è¡¨<br/>æ˜¯å¦å­˜åœ¨?}
    
    CHECK_PRODUCTS -->|å¦| ERROR1["âŒ è®°å½•é”™è¯¯<br/>æ²¡æœ‰é…ç½®PUSHORDER_PRODUCT<br/>ç³»ç»Ÿå‚æ•°<br/>ã€è¢«è¿«ç»“æŸã€‘"]
    
    CHECK_PRODUCTS -->|æ˜¯| LOOP_PRODUCTS["ğŸ”„ å¾ªç¯äº§å“åˆ—è¡¨"]
    
    LOOP_PRODUCTS --> GET_HALF_AI_USERS["ğŸ” æŸ¥è¯¢åŠAIæ¨å•ç”¨æˆ·<br/>product = ?<br/>status = 0<br/>userType = '1'<br/>AIç±»å‹: åŠAIæ¨å•ç”¨æˆ·"]
    
    GET_HALF_AI_USERS --> CHECK_HALF_AI_USERS{æŸ¥è¯¢åˆ°<br/>åŠAIç”¨æˆ·?}
    
    CHECK_HALF_AI_USERS -->|å¦| SKIP_PRODUCT["â­ï¸ è·³è¿‡æ­¤äº§å“<br/>ğŸ“ è®°å½•æ—¥å¿—"]
    
    CHECK_HALF_AI_USERS -->|æ˜¯| LOOP_HALF_AI_USERS["ğŸ”„ å¾ªç¯åŠAIç”¨æˆ·åˆ—è¡¨"]
    
    LOOP_HALF_AI_USERS --> QUERY_USER_BETS["ğŸ” æŸ¥è¯¢ç”¨æˆ·å†å²æ³¨å•æ•°æ®<br/>SELECT * FROM user_bet<br/>WHERE userName = ?<br/>AND product = ?<br/>AND betTime >= CURDATE-30"]
    
    QUERY_USER_BETS --> CHECK_BETS{æŸ¥è¯¢åˆ°<br/>å†å²æ³¨å•?}
    
    CHECK_BETS -->|å¦| SKIP_HALF_AI_USER["â­ï¸ è·³è¿‡è¯¥ç”¨æˆ·<br/>æ— å†å²æ•°æ®å¯å‚è€ƒ"]
    
    CHECK_BETS -->|æ˜¯| ANALYZE_BETS["ğŸ“Š åˆ†æç”¨æˆ·å†å²æ³¨å•<br/>è®¡ç®—èƒœç‡/ä¸­å¥–ç‡<br/>æå–ç”¨æˆ·åå¥½èµ›äº‹ç±»å‹<br/>åˆ†æå¸¸ç”¨æŠ•æ³¨æ–¹å¼"]
    
    ANALYZE_BETS --> GET_MATCHES["ğŸ” æŸ¥è¯¢å³å°†å¼€èµ›çš„èµ›äº‹<br/>æœªæ¥2å¤©å†…çš„æ¯”èµ›<br/>ä¼˜å…ˆé€‰æ‹©ç”¨æˆ·åå¥½ç±»å‹"]
    
    GET_MATCHES --> CHECK_MATCHES{æŸ¥è¯¢åˆ°<br/>èµ›äº‹?}
    
    CHECK_MATCHES -->|å¦| SKIP_HALF_AI_USER
    
    CHECK_MATCHES -->|æ˜¯| FILTER_ODDS["ğŸ” è¿‡æ»¤èµ›äº‹oddsæ•°æ®<br/>æ’é™¤ odds = null<br/>æ’é™¤ odds = []"]
    
    FILTER_ODDS --> CHECK_ODDS{æœ‰æ•ˆ<br/>èµ›äº‹æ•°?}
    
    CHECK_ODDS -->|å¦| SKIP_HALF_AI_USER
    
    CHECK_ODDS -->|æ˜¯| LOOP_MATCHES["ğŸ”„ å¾ªç¯èµ›äº‹åˆ—è¡¨"]
    
    LOOP_MATCHES --> PREPARE_CONTEXT["ğŸ“‹ å‡†å¤‡AIåˆ†æä¸Šä¸‹æ–‡<br/>èµ›äº‹ä¿¡æ¯ + èµ”ç‡æ•°æ®<br/>+ ç”¨æˆ·å†å²æ³¨å•åˆ†æ<br/>+ ç”¨æˆ·åå¥½æ¨¡å¼"]
    
    PREPARE_CONTEXT --> CALL_AI["ğŸ¤– è°ƒç”¨AIæ¥å£<br/>AIç±»å‹: è±†åŒ…/KIMI<br/>è¾“å…¥: èµ›äº‹+èµ”ç‡+ç”¨æˆ·å†å²æ•°æ®<br/>æ¨¡å¼: çœŸå®ç©å®¶é£æ ¼åˆ†æ"]
    
    CALL_AI --> CHECK_AI{AIè°ƒç”¨<br/>æˆåŠŸ?}
    
    CHECK_AI -->|å¦| LOG_AI_ERROR["ğŸ“ è®°å½•AIè°ƒç”¨å¤±è´¥<br/>ç»§ç»­ä¸‹ä¸€æ¡èµ›äº‹"]
    
    CHECK_AI -->|æ˜¯| PARSE_AI_RESULT["ğŸ“Š è§£æAIç»“æœ<br/>{æ ‡é¢˜, åˆ†æç»“æœ[]}<br/>èå…¥ç”¨æˆ·å†å²é£æ ¼"]
    
    LOG_AI_ERROR --> LOOP_MATCHES
    
    PARSE_AI_RESULT --> SAVE_DB["ğŸ’¾ ä¿å­˜æ¨å•å†…å®¹<br/>INSERT push_order_content<br/>pushOrderType = 'createReal'<br/>userType = 'half'<br/>status = 0"]
    
    SAVE_DB --> UPDATE_COUNT["ğŸ”¢ æ›´æ–°æ¨å•è®¡æ•°<br/>successTotal++"]
    
    UPDATE_COUNT --> LOOP_MATCHES
    
    LOOP_MATCHES -->|ç»§ç»­| LOOP_MATCHES
    LOOP_MATCHES -->|ç»“æŸ| SKIP_HALF_AI_USER
    
    SKIP_HALF_AI_USER -->|ç»§ç»­| LOOP_HALF_AI_USERS
    SKIP_HALF_AI_USER -->|ç»“æŸ| LOOP_HALF_AI_USERS
    
    LOOP_HALF_AI_USERS -->|ç»§ç»­| LOOP_HALF_AI_USERS
    LOOP_HALF_AI_USERS -->|ç»“æŸ| SKIP_PRODUCT
    
    SKIP_PRODUCT -->|ç»§ç»­| LOOP_PRODUCTS
    SKIP_PRODUCT -->|ç»“æŸ| STATS["ğŸ“Š ç»Ÿè®¡æ±‡æ€»<br/>çœŸå®æ¨å•æ€»æ•°: successTotal"]
    
    STATS --> LOG_END["ğŸ“ è®°å½•æ—¥å¿—<br/>AIçœŸå®æ¨å• å®šæ—¶ä»»åŠ¡ã€ç»“æŸã€‘<br/>æœ¬æ¬¡ç”Ÿæˆ N å•çœŸå®æ¨å•"]
    
    LOG_END --> END([âœ… ä»»åŠ¡å®Œæˆ])
    
    ERROR1 --> END_ERROR([âŒ ä»»åŠ¡å¤±è´¥])
    
    style START fill:#4CAF50,color:#fff
    style END fill:#4CAF50,color:#fff
    style END_ERROR fill:#f44336,color:#fff
    style ERROR1 fill:#f44336,color:#fff
    style CALL_AI fill:#2196F3,color:#fff
    style SAVE_DB fill:#FF9800,color:#fff
    style CHECK_PRODUCTS fill:#FFC107,color:#000
    style CHECK_HALF_AI_USERS fill:#FFC107,color:#000
    style CHECK_BETS fill:#FFC107,color:#000
    style CHECK_MATCHES fill:#FFC107,color:#000
    style CHECK_ODDS fill:#FFC107,color:#000
    style CHECK_AI fill:#FFC107,color:#000
    style ANALYZE_BETS fill:#9C27B0,color:#fff
    style PREPARE_CONTEXT fill:#9C27B0,color:#fff

            </div>
            
            <div class="legend">
                <h3>å›¾ä¾‹è¯´æ˜</h3>
                <div class="legend-items">
                    <div class="legend-item">
                        <div class="legend-color color-green"></div>
                        <span>å¼€å§‹/ç»“æŸèŠ‚ç‚¹</span>
                    </div>
                    <div class="legend-item">
                        <div class="legend-color color-blue"></div>
                        <span>å¤–éƒ¨æœåŠ¡è°ƒç”¨ï¼ˆAIï¼‰</span>
                    </div>
                    <div class="legend-item">
                        <div class="legend-color color-orange"></div>
                        <span>æ•°æ®åº“æ“ä½œ</span>
                    </div>
                    <div class="legend-item">
                        <div class="legend-color color-yellow"></div>
                        <span>æ¡ä»¶åˆ¤æ–­</span>
                    </div>
                    <div class="legend-item">
                        <div class="legend-color color-purple"></div>
                        <span>å¤æ‚ä¸šåŠ¡é€»è¾‘</span>
                    </div>
                    <div class="legend-item">
                        <div class="legend-color color-red"></div>
                        <span>é”™è¯¯/å¼‚å¸¸å¤„ç†</span>
                    </div>
                </div>
            </div>
        </div>
        
        <div class="footer">
            <p>ğŸ’» çº¢å•å®šæ—¶ä»»åŠ¡æµç¨‹å›¾ | ç”Ÿæˆæ—¶é—´: 2026-01-30 | å›¾è¡¨è‡ªåŠ¨ç”Ÿæˆç‰ˆæœ¬</p>
        </div>
    </div>
    
    <script>
        mermaid.initialize({
            startOnLoad: true,
            theme: 'default',
            flowchart: { useMaxWidth: true }
        });
        mermaid.contentLoaded();
    </script>
</body>
</html>
