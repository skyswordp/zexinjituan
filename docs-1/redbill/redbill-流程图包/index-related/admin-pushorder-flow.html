<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>åå°æ¨å•ç”Ÿæˆæµç¨‹</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            font-family: "Microsoft YaHei", Arial, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }
        .container { max-width: 900px; margin: 0 auto; }
        .header { text-align: center; color: white; margin-bottom: 30px; }
        .header h1 { font-size: 34px; margin-bottom: 8px; }
        .header p { font-size: 14px; opacity: 0.9; }
        .card {
            background: white;
            border-radius: 10px;
            padding: 22px;
            box-shadow: 0 5px 20px rgba(0,0,0,0.15);
            margin-bottom: 20px;
        }
        .card h3 { color: #333; font-size: 18px; margin-bottom: 10px; }
        .desc { color: #666; font-size: 14px; margin-bottom: 12px; }
        pre {
            background: #f7f7fb;
            padding: 16px;
            border-radius: 8px;
            overflow: auto;
            font-size: 12px;
            line-height: 1.6;
        }
        .mermaid { max-width: 794px; margin: 0 auto; }
        .mermaid svg { max-width: 100%; height: auto; }
        @page { size: A4 portrait; margin: 12mm; }
        @media print {
            body { background: white; padding: 0; }
            .container { max-width: 794px; }
            .card { padding: 16px; box-shadow: none; }
        }
        ol { padding-left: 18px; color: #444; line-height: 1.8; font-size: 14px; }
        a { color: #667eea; text-decoration: none; font-weight: bold; }
        .footer { text-align: center; margin-top: 30px; color: white; opacity: 0.8; font-size: 12px; }
        .phase {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 8px 16px;
            border-radius: 5px;
            display: inline-block;
            margin-bottom: 10px;
            font-size: 14px;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>âš™ï¸ åå°æ¨å•ç”Ÿæˆæµç¨‹</h1>
            <p>ä»£ç  â†’ Mermaid â†’ HTML è¯´æ˜ (è¿è¥ä¾§å®Œæ•´é“¾è·¯)</p>
        </div>

        <div class="card">
            <h3>1) ä»£ç è§†å›¾ï¼ˆåå°ç®¡ç†æœåŠ¡è°ƒç”¨é“¾ï¼‰</h3>
            <p class="desc">å¯¹åº” dc-api-office åå°ä¾§æ¥å£ä¸æœåŠ¡é“¾è·¯</p>
            <pre>// ===== é˜¶æ®µ1: é…ç½®å‡†å¤‡ =====
POST /pushOrderParamConfig/update
  -> PushOrderParamConfigController.update()
  -> IMasterPushOrderParamConfigService.updateConfig()
  -> DB: master_push_order_param_config

POST /levelTitleConfig/add
  -> PushOrderLevelTitleConfigController.add()
  -> DB: master_push_order_level_title_config

// ===== é˜¶æ®µ2: AIç”¨æˆ·åˆ›å»ºä¸å¯åŠ¨ =====
POST /pushOrderAiUser/add
  -> PushOrderAiUserController.add()
  -> IMasterPushOrderAiUserService.createAiUser()
  -> DB: master_push_order_ai_user

POST /pushOrderAiUser/startAI
  -> PushOrderAiUserController.startAI()
  -> IAIPushOrderService.startAIGeneration()
  -> è°ƒåº¦å®šæ—¶ä»»åŠ¡ (21:00:00)

// ===== é˜¶æ®µ3: å†…å®¹ç”Ÿæˆ =====
POST /pushOrderContent/generateContent
  -> PushOrderContentManagementController.generateContent()
  -> IMasterPushOrderContentManagementService.generateContent()
  -> AIé€»è¾‘:
     1. æŸ¥è¯¢æœªæ¥2å¤©èµ›äº‹ (DC-API-2018/dc-service)
     2. åˆ†æèµ”ç‡æ•°æ®
     3. ç”Ÿæˆæ¨å•æ–‡æ¡ˆ
  -> DB: master_push_order_content_management (status=DRAFT)

POST /pushOrderContent/previewContent
  -> PushOrderContentManagementController.previewContent()
  -> è¿”å›ç”Ÿæˆçš„æ¨å•é¢„è§ˆæ•°æ®

// ===== é˜¶æ®µ4: å®¡æ ¸ä¸ç¼–è¾‘ =====
POST /pushOrderContent/editContent
  -> PushOrderContentManagementController.editContent()
  -> IMasterPushOrderContentManagementService.updateContent()
  -> DB: master_push_order_content_management (status=DRAFT)

POST /pushOrderContent/auditContent
  -> PushOrderContentManagementController.auditContent()
  -> IMasterPushOrderContentManagementService.auditContent()
  -> å®¡æ ¸è§„åˆ™æ£€æŸ¥ (æ•æ„Ÿè¯ã€åˆè§„æ€§)
  -> DB: master_push_order_content_management (status=AUDITED)

// ===== é˜¶æ®µ5: å‘å¸ƒ =====
POST /pushOrderContent/publishContent
  -> PushOrderContentManagementController.publishContent()
  -> IMasterPushOrderContentManagementService.publishContent()
  -> DB: master_push_order_content_management (status=PUBLISHED)
  -> è®°å½•æ—¥å¿—:
     -> PushOrderContentGeneralLogController.log()
     -> DB: master_push_order_content_general_log

// ===== é˜¶æ®µ6: å…¬å¼€å±•ç¤º =====
POST /pushOrderPublic/queryHotList
  -> PushOrderPublicController.queryHotList()
  -> æŸ¥è¯¢å·²å‘å¸ƒæ¨å• (status=PUBLISHED)
  -> è¿”å›ç»™å‰ç«¯/APP
</pre>
        </div>

        <div class="card">
            <h3>2) Mermaid æµç¨‹å›¾</h3>
            <p class="desc">é…ç½® â†’ AIå¯åŠ¨ â†’ ç”Ÿæˆ â†’ å®¡æ ¸ â†’ å‘å¸ƒ â†’ å±•ç¤º</p>
            <div class="mermaid">
flowchart TD
    A[ç®¡ç†å‘˜ç™»å½•åå°] --> B[é…ç½®ç³»ç»Ÿå‚æ•°\nParamConfig.update]
    B --> C[é…ç½®æ¨æ‰‹ç­‰çº§\nLevelTitleConfig.add]
    C --> D[åˆ›å»ºAIæ¨æ‰‹ç”¨æˆ·\nAiUser.add]
    D --> E[å¯åŠ¨AIç”Ÿæˆ\nAiUser.startAI]
    E --> F[å®šæ—¶ä»»åŠ¡è§¦å‘21:00\nQuartz Job]
    F --> G[AIç”Ÿæˆæ¨å•å†…å®¹\nContentMgmt.generateContent]
    G --> H[æŸ¥è¯¢æœªæ¥èµ›äº‹æ•°æ®]
    H --> I[åˆ†æèµ”ç‡ä¸æ¨è]
    I --> J[ç”Ÿæˆæ¨å•æ–‡æ¡ˆ]
    J --> K[ä¿å­˜è‰ç¨¿\nstatus=DRAFT]
    K --> L[å†…å®¹ç¼–è¾‘é¢„è§ˆ\nContentMgmt.previewContent]
    L --> M{æ˜¯å¦éœ€è¦ä¿®æ”¹}
    M -- æ˜¯ --> N[ç¼–è¾‘å†…å®¹\nContentMgmt.editContent]
    N --> L
    M -- å¦ --> O[æäº¤å®¡æ ¸\nContentMgmt.auditContent]
    O --> P{å®¡æ ¸æ˜¯å¦é€šè¿‡}
    P -- ä¸é€šè¿‡ --> N
    P -- é€šè¿‡ --> Q[å‘å¸ƒæ¨å•\nContentMgmt.publishContent]
    Q --> R[æ›´æ–°çŠ¶æ€=PUBLISHED]
    R --> S[è®°å½•å‘å¸ƒæ—¥å¿—\nContentGeneralLog.log]
    S --> T[æ¨å•è¿›å…¥å…¬å¼€åˆ—è¡¨\nPushOrderPublic.queryHotList]
    T --> U[ç”¨æˆ·ä¾§å¯è§]
            </div>
        </div>

        <div class="card">
            <h3>3) HTML è§†å›¾ï¼ˆåˆ†é˜¶æ®µæ­¥éª¤è¯´æ˜ï¼‰</h3>
            <p class="desc">æŒ‰è¿è¥æµç¨‹é¡ºåºæè¿°æ¯ä¸ªå…³é”®èŠ‚ç‚¹</p>
            
            <div class="phase">ğŸ“‹ é˜¶æ®µ1: é…ç½®å‡†å¤‡</div>
            <ol>
                <li>ç®¡ç†å‘˜é€šè¿‡ <strong>ParamConfig.update</strong> é…ç½®ç³»ç»Ÿå‚æ•°ï¼ˆå¦‚æ¨å•æ•°é‡ã€èµ”ç‡èŒƒå›´ï¼‰ã€‚</li>
                <li>ç®¡ç†å‘˜é€šè¿‡ <strong>LevelTitleConfig.add</strong> é…ç½®æ¨æ‰‹ç­‰çº§å’Œç§°å·è§„åˆ™ã€‚</li>
            </ol>

            <div class="phase">ğŸ¤– é˜¶æ®µ2: AIç”¨æˆ·åˆ›å»ºä¸å¯åŠ¨</div>
            <ol start="3">
                <li>ç®¡ç†å‘˜é€šè¿‡ <strong>AiUser.add</strong> åˆ›å»ºAIæ¨æ‰‹ç”¨æˆ·ï¼ˆè™šæ‹Ÿæ¨æ‰‹è´¦å·ï¼‰ã€‚</li>
                <li>ç®¡ç†å‘˜é€šè¿‡ <strong>AiUser.startAI</strong> å¯åŠ¨AIï¼Œç³»ç»Ÿå¼€å§‹ç›‘å¬å®šæ—¶ä»»åŠ¡ã€‚</li>
            </ol>

            <div class="phase">ğŸ¯ é˜¶æ®µ3: å†…å®¹ç”Ÿæˆ</div>
            <ol start="5">
                <li>å®šæ—¶ä»»åŠ¡åœ¨21:00è§¦å‘ï¼Œè°ƒç”¨ <strong>ContentMgmt.generateContent</strong>ã€‚</li>
                <li>AIæŸ¥è¯¢æœªæ¥2å¤©çš„èµ›äº‹æ•°æ®ï¼Œåˆ†æèµ”ç‡ï¼Œç”Ÿæˆæ¨å•æ–‡æ¡ˆã€‚</li>
                <li>ç”Ÿæˆçš„å†…å®¹ä¿å­˜ä¸ºè‰ç¨¿çŠ¶æ€ <strong>(status=DRAFT)</strong>ã€‚</li>
            </ol>

            <div class="phase">âœ… é˜¶æ®µ4: å®¡æ ¸ä¸ç¼–è¾‘</div>
            <ol start="8">
                <li>è¿è¥äººå‘˜é€šè¿‡ <strong>ContentMgmt.previewContent</strong> é¢„è§ˆç”Ÿæˆçš„æ¨å•ã€‚</li>
                <li>å¦‚éœ€ä¿®æ”¹ï¼Œè°ƒç”¨ <strong>ContentMgmt.editContent</strong> ç¼–è¾‘å†…å®¹ã€‚</li>
                <li>æäº¤å®¡æ ¸ï¼Œè°ƒç”¨ <strong>ContentMgmt.auditContent</strong> è¿›è¡Œåˆè§„æ€§æ£€æŸ¥ã€‚</li>
                <li>å®¡æ ¸é€šè¿‡åï¼ŒçŠ¶æ€æ›´æ–°ä¸º <strong>(status=AUDITED)</strong>ã€‚</li>
            </ol>

            <div class="phase">ğŸš€ é˜¶æ®µ5: å‘å¸ƒ</div>
            <ol start="12">
                <li>è¿è¥äººå‘˜è°ƒç”¨ <strong>ContentMgmt.publishContent</strong> å‘å¸ƒæ¨å•ã€‚</li>
                <li>çŠ¶æ€æ›´æ–°ä¸º <strong>(status=PUBLISHED)</strong>ï¼Œå¹¶è®°å½•å‘å¸ƒæ—¥å¿—ã€‚</li>
            </ol>

            <div class="phase">ğŸ“± é˜¶æ®µ6: å…¬å¼€å±•ç¤º</div>
            <ol start="14">
                <li>æ¨å•è¿›å…¥å…¬å¼€åˆ—è¡¨ï¼Œé€šè¿‡ <strong>PushOrderPublic.queryHotList</strong> å¯¹å¤–æä¾›ã€‚</li>
                <li>ç”¨æˆ·ä¾§ï¼ˆAPP/å°ç¨‹åºï¼‰å¯æŸ¥è¯¢åˆ°å·²å‘å¸ƒçš„æ¨å•ã€‚</li>
            </ol>
        </div>

        <div class="card">
            <h3>4) å…³é”®æ§åˆ¶ç‚¹</h3>
            <ol>
                <li><strong>æƒé™æ§åˆ¶</strong>: æ‰€æœ‰åå°æ¥å£éœ€è¦ç®¡ç†å‘˜æƒé™è®¤è¯ã€‚</li>
                <li><strong>çŠ¶æ€æµè½¬</strong>: DRAFT â†’ AUDITED â†’ PUBLISHEDï¼Œä¸å¯é€†å‘ã€‚</li>
                <li><strong>æ—¥å¿—è®°å½•</strong>: æ¯æ¬¡å‘å¸ƒéƒ½è®°å½•åˆ° ContentGeneralLogã€‚</li>
                <li><strong>AIå¥åº·æ£€æŸ¥</strong>: å®šæ—¶æ£€æŸ¥AIè¿è¡ŒçŠ¶æ€ï¼Œå¼‚å¸¸æ—¶è§¦å‘å‘Šè­¦ã€‚</li>
            </ol>
        </div>

        <div class="footer">
            <p>è¿”å›ç´¢å¼•ï¼š<a href="index.html">çº¢å•å®šæ—¶ä»»åŠ¡æµç¨‹å›¾</a></p>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/mermaid@10/dist/mermaid.min.js"></script>
    <script>
        mermaid.initialize({ startOnLoad: true, theme: "default" });
    </script>
</body>
</html>
