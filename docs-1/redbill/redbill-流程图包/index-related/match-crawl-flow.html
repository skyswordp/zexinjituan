<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>èµ›äº‹æŠ“å–æµç¨‹</title>
    <script src="https://cdn.jsdelivr.net/npm/mermaid/dist/mermaid.min.js"></script>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            font-family: "Microsoft YaHei", Arial, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }
        .container {
            max-width: 900px;
            margin: 0 auto;
            background: white;
            border-radius: 10px;
            box-shadow: 0 10px 40px rgba(0,0,0,0.3);
            overflow: hidden;
        }
        .header {
            background: linear-gradient(135deg, #2d9cdb 0%, #1b73c6 100%);
            color: white;
            padding: 30px;
            text-align: center;
        }
        .header h1 { font-size: 28px; margin-bottom: 8px; }
        .header p { font-size: 14px; opacity: 0.9; }
        .content { padding: 32px; }
        .chart-container {
            background: #f8f9fa;
            border-radius: 8px;
            padding: 24px;
            max-width: 794px;
            margin: 0 auto;
        }
        .note {
            margin-top: 16px;
            color: #666;
            font-size: 13px;
        }
        .mermaid svg { max-width: 100%; height: auto; }
        @page { size: A4 portrait; margin: 12mm; }
        @media print {
            body { background: white; padding: 0; }
            .container { max-width: 794px; border-radius: 0; box-shadow: none; }
            .content { padding: 24px; }
            .chart-container { padding: 16px; }
        }
        .back-button {
            display: inline-block;
            margin-top: 20px;
            padding: 10px 22px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            text-decoration: none;
            border-radius: 6px;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>ğŸ“¡ èµ›äº‹æŠ“å–æµç¨‹</h1>
            <p>æŠ“å– â†’ æ¸…æ´— â†’ å…¥åº“ â†’ å…³è”æ¨å•</p>
        </div>
        <div class="content">
            <div class="chart-container">
                <div class="mermaid">
flowchart TB
    Start["ContextProvider.initQuartzTask()"] --> FB["FbDataTask<br/>scheduleWithFixedDelay(FbEventTask, 1h)"]
    Start --> NamiF["NamiFootballTask<br/>MatchLive(5s) / BaseData(5m)<br/>SeasonTable(2m) / Analysis(2m)<br/>Lineup(2m) / OddsLive(2m)"]
    Start --> NamiB["NamiBasketballTask<br/>BaseData(5m) / MatchLive(5s)<br/>SeasonTable(2m) / Analysis(2m)<br/>OddsLive(2m)"]
    Start --> OB["ObDataTask<br/>ObEvent(3m) / HotLeague(120s)<br/>MatchDataList(3m) / ObPlayTask(queue)"]
    Start --> NamiLink["NamiMatchLinkTask<br/>matchLink(1m)"]
    Start --> WC["WorldCup Tasks<br/>ScheduleByList(1h)<br/>StatsDetailPlayer(2h)<br/>StatsDetailTeams(1h)<br/>TableDetail(1h)"]

    subgraph FB_Flow["FBèµ›äº‹æŠ“å–é“¾è·¯"]
        direction TB
        FB --> FB1["FbSportService.getEventList()"]
        FB1 --> FB2["HttpUtils.doJsonPost<br/>/v1/match/getList"]
        FB2 --> FB3["handleFbEventList()<br/>è§£æè”èµ›/èµ›äº‹/çƒé˜Ÿ"]
        FB3 --> FB4["SportLeaguesMapper.saveSportLeagues"]
        FB3 --> FB5["SportLeaguesMapper.saveSportMatchs"]
        FB3 --> FB6["SportLeaguesMapper.saveSportTeams"]
    end

    subgraph OB_Flow["OBèµ›äº‹æŠ“å–é“¾è·¯"]
        direction TB
        OB --> OB1["OBEventService.getEventList()"]
        OB1 --> OB2["HttpUtils.httpGet<br/>/menu/initPB"]
        OB1 --> OB3["HttpUtils.HttpPost<br/>/matchesPB"]
        OB3 --> OB4["è§£æè”èµ›/èµ›äº‹/çƒé˜Ÿ"]
        OB4 --> OB5["SportLeaguesMapper.saveSportLeagues"]
        OB4 --> OB6["SportLeaguesMapper.saveSportMatchs"]
        OB4 --> OB7["SportLeaguesMapper.saveSportTeams"]
        OB6 --> OBQ["OneManager.matchIds queue"]
        OBQ --> OB8["ObPlayTask<br/>batchUpdateMatchOdds()"]
        OB8 --> OB9["HttpUtils.httpGet<br/>/getMatchOddsInfoPB"]
    end

    subgraph Nami_Football["çº³ç±³è¶³çƒæ•°æ®é“¾è·¯"]
        direction TB
        NamiF --> NF1["handlerFootBallData(api)<br/>MATCH/COMPETITION/TEAM/PLAYER/<br/>COACH/SEASON/HONOR/STAGE"]
        NF1 --> NF2["HttpUtils.httpClientGet<br/>Nami API"]
        NF2 --> NF3["NamiFootballMapper.opDatabase()<br/>æ‰¹é‡å…¥åº“"]
        NamiF --> NF4["handlerFootballMatchDetailLive()"]
        NamiF --> NF5["handleSeasonTableDetail()"]
        NamiF --> NF6["handleFootballMatchsAnalysis()"]
        NamiF --> NF7["handleFootballMatchsLineups()"]
        NamiF --> NF8["handleFootballOddsLive()"]
    end

    subgraph Nami_Basketball["çº³ç±³ç¯®çƒæ•°æ®é“¾è·¯"]
        direction TB
        NamiB --> NB1["handlerBasketBallData(api)<br/>MATCH/COMPETITION/TEAM/<br/>SEASON/STAGE/PLAYER/COACH"]
        NB1 --> NB2["HttpUtils.httpClientGet<br/>Nami API"]
        NB2 --> NB3["NamiBasketballMapper.opDatabase()<br/>æ‰¹é‡å…¥åº“"]
        NamiB --> NB4["handlerBasketBallMatchLive()"]
        NamiB --> NB5["handleSeasonTableDetail()"]
        NamiB --> NB6["handleBasketballMatchsAnalysis()"]
        NamiB --> NB7["handleBasketballOddsLive()"]
    end

    subgraph Link_Flow["çº³ç±³èµ›äº‹å…³è”"]
        direction TB
        NamiLink --> L1["NamiMatchLinkService.matchLink()<br/>çº³ç±³èµ›äº‹ â†” ç†ŠçŒ«èµ›äº‹"]
    end

    subgraph WC_Flow["ä¸–ç•Œæ¯èµ›ç¨‹/ç»Ÿè®¡"]
        direction TB
        WC --> WC1["WorldCupNamiDataService.scheduleByList()"]
        WC --> WC2["WorldCupNamiDataService.statsDetail('player')"]
        WC --> WC3["WorldCupNamiDataService.statsDetail('teams')"]
        WC --> WC4["WorldCupNamiDataService.tableDetailList()"]
    end
                </div>
                <div class="note">æ¥æºï¼šdc-api-sportcron çš„ ContextProvider + å„ä»»åŠ¡ç±»/Service å®ç°ï¼Œä¸€æ¯”ä¸€æ˜ å°„ä»£ç é“¾è·¯ã€‚</div>
            </div>
            <a href="index.html" class="back-button">â† è¿”å›é¦–é¡µ</a>
        </div>
    </div>
    <script>
        mermaid.initialize({
            startOnLoad: true,
            theme: 'default',
            flowchart: { useMaxWidth: true }
        });
    </script>
</body>
</html>
